<!doctype html>
<html>

<!--
In this example we do not use authentication and authorization
to access our backend SQL database.
-->

<head>
<title>Example 02. FBSQL: Using promise API</title>
<script src="http://localhost:8080/fbsql/fbsql.min.js"></script>
</head>

<body>
	<script type="text/javascript">
		"use strict"

		const conn = new Connection('my-h2', 'john', 'secret', 'manager');

		/* Listen to database events */
		conn.logDatabaseEvents(document.body, false);

		conn.prepareStatement("SELECT * FROM employees")
		.logExecuteQuery(document.body, false)
		.then(resultSet => {
			return conn.prepareStatement("DELETE FROM employees")
			.logExecuteUpdate(document.body, false);
		})
		.then(result => {
			return conn.prepareStatement("SELECT * FROM employees")
			.logExecuteQuery(document.body, false);
		})
		.then(resultSet => {
			return conn.prepareStatement("INSERT INTO employees (FIRST_NAME, DATE_OF_BIRTH) VALUES(:first_name, :date_of_birth)")
			.logExecuteUpdate(document.body, false,
				[
					{first_name: 'John',     date_of_birth: '1997-10-27'},
					{first_name: 'Leonardo', date_of_birth: '1982-03-19'}
				]
			);
		})
		.then(result => {
			return conn.prepareStatement("SELECT * FROM employees")
			.logExecuteQuery(document.body, false);
		})
		.then(resultSet => {
			return conn.prepareStatement("UPDATE employees SET DATE_OF_BIRTH = :date_of_birth WHERE FIRST_NAME = :first_name")
			.logExecuteUpdate(document.body, false,
				{
					first_name: 'John',
					date_of_birth: '1998-10-27'
				}
			);
		})
		.then(result => {
			return conn.prepareStatement("SELECT * FROM employees")
			.logExecuteQuery(document.body, false);
		});

	</script>
</body>

</html>
