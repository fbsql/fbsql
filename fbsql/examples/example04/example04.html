<!doctype html>
<html>

<!--
In this example we do not use authentication and authorization
to access our backend SQL database.
-->

<head>
<title>Example 04. FBSQL: Database event notification</title>
<script src="http://localhost:8080/fbsql/fbsql.min.js"></script>
<style type="text/css">
table {
	border-color: #ddd;
	border-collapse: collapse;
}

tr {
	border: 1px solid;
	border-color: #ddd;
}

td {
	vertical-align: top;
}

td div {
	padding: 1rem;
	font-family: monospace;
	white-space: pre;
}

td div:nth-child(even) {
	background-color: #f2f2f2;
}

td div:nth-child(odd) {
	background-color: #fff;
}
</style>
</head>

<body>
	<button id="buttonSelect">Select records</button>
	<button id="buttonAdd">Add records</button>
	<button id="buttonDelete">Delete records</button>
	<br>
	<br>
	<table border="1">
		<tr>
			<td id="results"></td>
			<td id="events"></td>
		</tr>
	</table>
	<script type="text/javascript">
        "use strict"

        let results = document.getElementById('results');
        let events = document.getElementById('events');
        let buttonAdd = document.getElementById('buttonAdd');
        let buttonDelete = document.getElementById('buttonDelete');
        let buttonSelect = document.getElementById('buttonSelect');


        /* Connect to default database instance (instance with alias name 'fbsql-default') */
        //const conn = new Connection();

        /* Connect to default database instance (instance with alias name 'fbsql-default') */
        //const conn = new Connection('fbsql-default');

        /* Connect to default database instance (instance with alias name 'fbsql-default') */
        //const conn = new Connection(null);

        /* Connect to default database instance (instance with alias name 'fbsql-default') */
        //const conn = new Connection(undefined);

        /* Connect to database instance with alias name 'h2-example02' by providing instance alias name */
        //const conn = new Connection('h2-example02');

        /* Connect to database instance with alias name 'h2-example02' providing instance URL string */
        //const conn = new Connection('http://localhost:8080/h2-example02');

        /* Connect to database instance with alias name 'h2-example02' providing instance URL object */
        //const conn = new Connection(new URL('http://localhost:8080/h2-example02'));

        /* Connect to database instance with alias name 'h2-example02', user 'john' and password 'secret' */
        //const conn = new Connection('h2-example02', 'john', 'secret');

        /* Connect to database instance with alias name 'h2-example02', user 'john', password 'secret' and role 'manager' */
        //const conn = new Connection({url: 'h2-example04', username: 'john', password: 'secret', role: 'manager', local: false});
        const conn = new Connection('h2-example02', 'john', 'secret', 'manager');

		/* Listen to database events */
		conn.logDatabaseEvents(document.body, true);

        buttonSelect.addEventListener('click', function(event) {
    		conn.prepareStatement("SELECT * FROM employees").logExecuteQuery(document.body, true);
        });

        buttonAdd.addEventListener('click', function(event) {
    		conn.prepareStatement("INSERT INTO employees (FIRST_NAME, DATE_OF_BIRTH) VALUES(:first_name, :date_of_birth)")
    			.logExecuteUpdate(document.body, true,
    				[
    					{first_name: 'John',     date_of_birth: '1997-10-27'},
    					{first_name: 'Leonardo', date_of_birth: '1982-03-19'}
    				]
    			);
    		});
        
        buttonDelete.addEventListener('click', function(event) {
    		conn.prepareStatement("DELETE FROM employees")
    			.logExecuteUpdate(document.body, true);
    		});
        
    </script>
</body>

</html>
